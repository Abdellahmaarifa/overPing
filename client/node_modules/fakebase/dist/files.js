"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.writeJson = exports.readOrCreateJson = exports.createParentDir = void 0;
const promises_1 = require("fs/promises");
const path_1 = require("path");
async function createParentDir(file) {
    const dir = (0, path_1.dirname)(file);
    try {
        const stats = await (0, promises_1.stat)(dir);
        if (!stats.isDirectory()) {
            throw new Error(`Path exists but is not a directory: '${dir}'`);
        }
    }
    catch (err) {
        if (err.code === 'ENOENT') {
            await (0, promises_1.mkdir)(dir, { recursive: true });
        }
        else {
            throw err;
        }
    }
}
exports.createParentDir = createParentDir;
async function readOrCreateJson(file, defaultValue) {
    try {
        const data = await (0, promises_1.readFile)(file, 'utf8');
        return JSON.parse(data);
    }
    catch (err) {
        if (err.code === 'ENOENT') {
            await createParentDir(file);
            await writeJson(file, defaultValue);
            return defaultValue;
        }
        throw err;
    }
}
exports.readOrCreateJson = readOrCreateJson;
function writeJson(file, value) {
    const data = JSON.stringify(value, null, 2);
    return (0, promises_1.writeFile)(file, data, 'utf8');
}
exports.writeJson = writeJson;
